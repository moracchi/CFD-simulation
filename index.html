<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CFD ポジションシミュレーター</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <!-- ヘッダー -->
        <header class="header">
            <h1>CFD ポジションシミュレーター</h1>
            <p>段階的なポジション構築のリスク・リターンを可視化</p>
        </header>

        <!-- 設定パネル -->
        <section class="settings-panel">
            <h2>シミュレーション設定</h2>
            
            <!-- 基本設定 - HTML5バリデーション強化 -->
            <div class="basic-settings">
                <div class="input-group">
                    <label for="startPrice">ポジションエントリー開始価格</label>
                    <input type="number" id="startPrice" value="41150" 
                           min="1" step="1" required 
                           title="1円以上の整数で入力してください">
                    <span class="unit">円</span>
                </div>
                
                <div class="input-group">
                    <label for="direction">売買方向</label>
                    <select id="direction" required>
                        <option value="sell">売り</option>
                        <option value="buy">買い</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="addInterval">ポジション追加の価格幅</label>
                    <input type="number" id="addInterval" value="200" 
                           min="1" step="1" required 
                           title="1円以上の整数で入力してください">
                    <span class="unit">円</span>
                </div>
                
                <div class="input-group">
                    <label for="displayInterval">表示する価格間隔</label>
                    <input type="number" id="displayInterval" value="1000" 
                           min="1" step="1" required 
                           title="1円以上の整数で入力してください">
                    <span class="unit">円</span>
                </div>
            </div>

            <!-- ポジションサイズルール -->
            <div class="position-rules">
                <h3>ポジションサイズルール</h3>
                <div class="rules-header">
                    <span>開始価格</span>
                    <span>終了価格</span>
                    <span>追加サイズ</span>
                    <span>操作</span>
                </div>
                <div id="rulesContainer">
                    <!-- 動的に生成されるルール -->
                </div>
                <button type="button" id="addRuleBtn" class="add-rule-btn">+ ルールを追加</button>
            </div>

            <!-- 実行ボタン -->
            <button type="button" id="simulateBtn" class="simulate-btn">シミュレーション実行</button>
        </section>

        <!-- 結果パネル -->
        <section class="results-panel" id="resultsPanel" style="display: none;">
            <h2>シミュレーション結果</h2>
            
            <!-- サマリー -->
            <div class="summary" id="summary">
                <!-- 結果サマリーが表示される -->
            </div>

            <!-- タブ切り替え -->
            <div class="tabs">
                <button class="tab-btn active" data-tab="table">結果テーブル</button>
                <button class="tab-btn" data-tab="chart">グラフ</button>
            </div>

            <!-- テーブル表示 -->
            <div class="tab-content active" id="tableTab">
                <div class="table-container">
                    <table id="resultsTable">
                        <thead>
                            <tr>
                                <th>価格</th>
                                <th>累計ポジション数</th>
                                <th>平均取得単価</th>
                                <th>評価損益</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- 結果が動的に生成される -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- グラフ表示 -->
            <div class="tab-content" id="chartTab">
                <div class="chart-container">
                    <canvas id="profitChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="positionChart"></canvas>
                </div>
            </div>
        </section>

        <!-- エラーメッセージ -->
        <div id="errorMessage" class="error-message" style="display: none;"></div>
    </div>

    <script src="script.js"></script>
</body>
</html>
